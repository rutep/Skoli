%%
%%  Beinagrind fyrir Morpho handbók í LaTeX.
%%  Til að keyra þetta gegnum LaTeX forritið
%%  má t.d. nota pdflatex í cygwin með eftir-
%%  farandi skipun í bash:
%%
%%       pdflatex handbok
%%   eða (virkar líka í cmd):
%%       bash -c 'pdflatex handbok'
%%
\documentclass[12pt,a4paper]{article}
\usepackage[icelandic]{babel}
\usepackage[pdftex]{hyperref}
%\usepackage{makeidx,smplindx,fancyhdr,graphicx,times,multicol,comment}
\usepackage{times}
\usepackage[T1]{fontenc}
\usepackage[rounded]{syntax}
\usepackage{listings}
\usepackage[a4paper, total={7in, 10in}]{geometry}
\newenvironment{repnull}[0]{%
	\begin{stack}
	\\
	\begin{rep}
}{%
	\end{rep}
	\end{stack}
}
\newenvironment{málrit}[1]{%
	\par\noindent\begin{minipage}{\linewidth}\vspace{0.5em}\begin{quote}\noindent%
	\hspace*{-2em}\synt{#1}:\hfill\par%
	\noindent%
	\begin{minipage}{\linewidth}\begin{syntdiag}%
}{%
	\end{syntdiag}\end{minipage}\end{quote}\end{minipage}%
}

\begin{document}
\sloppy
\title{Handbók fyrir NanoMorpho}
\author{Pétur Daníel Ámundason}
\maketitle

\pagebreak

\tableofcontents

\pagebreak

\section{Inngangur}

\paragraph{Enn einn þýðandi NanoMorpho} Einföld útgáfa af Morpho. NanoMorpho er bálkmótað mál.

\section{Notkun og uppsetning}

\paragraph{Uppsetning} Notast skal við Git til þess að sækja þýðandan.

\paragraph{Git} \$ Git clone https://Github.com/rutep/NanoMorpho.Git
\\
Þegar náð hefur verið í skrár þá eru þær þrjár skrár. \textbf{NanoMorphoLexer.java} sem er lesgreinir, \textbf{NanoMorphoParser.java} og \textbf{NanoMorphoParserVal.java} sem sjá um þáttun og milli þulusmíði.

\paragraph{Morpho} Morphoskrárnar eru til þess að geta þýtt  \textbf{NanoMorpho} skrár  yfir á Morpho smalarmál og smalarmálið yfir í keyrslu hæfa Morphoskrá. Þegar fyrrnefnda er búið þá er hægt að keyra forritið í gegnum Morpho.

\paragraph{makefile} Hér fyrir neðan sést makefile skrá sem hægt er að nota til þess að auðvelda sér þýðingu og keyrslu \textbf{NanoMorpho} forrits. Ef búnaður er ekki til staðar til þess að nota makefile skrá þá er hægt að keyra beint skipanir á skipunarlínu ef java þýðandi og Morpho er upp sett.

\begin{itemize}
	\item \$ javac NanoMorphoLexer.java NanoMorphoParser.java NanoMorphoParserVal.java 
	\item Skipuninn að ofan þýðir java skrár
	\item \$ java NanoMorphoParser test.s > test.masm
	\item Býr til Morpho smalarmáls skrá test.masm
	\item \$ Morpho -c test.masm
	\item \$ Morpho test
	\item Býr til test.mexem skrá og svo keyrir forrit
\end{itemize}

\begin{lstlisting}
SHELL=/usr/bin/env /bin/bash

parser: NanoMorphoParser.java NanoMorphoParserVal.java NanoMorphoLexer.java
javac NanoMorphoLexer.java NanoMorphoParser.java NanoMorphoParserVal.java

test: NanoMorphoParser.class NanoMorphoParserVal.class
java NanoMorphoParser test.s > test.masm 

compile: test.masm
Morpho -c test.masm

run: test.mexe
Morpho test 
	
\end{lstlisting}

\section{Málfræði}
\subsection{Frumeiningar málsins}

\paragraph{Samhengislaust mál} Línubil og línu endingar hafa enga merkingu fyrir þíðandan og væri hægt að skrifa heilu forritin í einni línu með engum línubilum.
\subsubsection{Athugasemd}
\paragraph{Dæmi um athugasemd} ;;; Hunsað af þýðanda
Þýðandinn mun hunsa allt sem kemur á eftir athugarsemdar í þeirri línu sem hún er.

\subsubsection{Lykilorð}
Lykilorðin í þýðandanum eru:\\
else, elsif, false, if, null, return, true, var, while, println
\subsection{Mállýsing}

\begin{málrit}{idlist}
	\begin{stack}
		\\
		\begin{rep} <NAME> \\ `,' \end{rep}
	\end{stack}
\end{málrit}%

\begin{málrit}{exprs}
	\begin{rep}
		<expr> ';'
	\end{rep}
\end{málrit}%

\subsubsection{Forrit}

\begin{málrit}{program}
	\begin{rep}
		<function>
	\end{rep}
\end{málrit}

\subsubsection{Föll}

\begin{málrit}{function}
	<NAME> `(' <idlist> `)' '\{' <VAR>  <idlist> ';' <exprs> '\}'
\end{málrit}

\subsubsection{Stofnar}
\begin{málrit}{body}
	`{' 
		\begin{rep}
		<expr> ';'	
		\end{rep}
	`}' 
\end{málrit}

\subsubsection{Segðir}

\begin{málrit}{expr}
	\begin{stack}
		<RETURN> <expr>	
		\\
		<NAME> '=' <expr>
		\\
		<NOT> <expr>
		\\
		<expr> <AND> <expr>
		\\
		`while' '(' <expr> ')' <body>
		\\
		'println' '(' <expr> ')'
		\\
		`if' '(' <expr> ')' <body> <ifrest>
		\\
		`if' '(' <expr> ')' <body>
		\\
		<expr> <OP> <expr>
		\\
		'(' <expr> ')'
		\\
		<NAME> '(' arg ')'
		\\
		<OP> <expr>
		\\
		<NAME>
		\\
		<int>
		\\
		<float>
		\\
		<string>
		\\
		<char>
		\\
		`true'
		\\
		`false'
		\\
		`null'
	\end{stack}
\end{málrit}

\begin{málrit}{arg}
	\begin{rep}
		expr \\ ','
	\end{rep}
\end{málrit}

\begin{málrit}{ifrest}
	\begin{stack}
		'else' <body>
		\\
		'elseif' '(' <expr> ')' <body>
		\\
		'elseif' '(' <expr> ')' <body> <ifrest>
	\end{stack}
\end{málrit}
		
\section{Merking málsins}
NanoMorpho skiptis upp í að það er eitt main fall sem keyrt er og úr því er hægt að kalla á önnur skilgreind föll.

\begin{lstlisting}
	foo(){
		var a;
		a = 1;
		return a;	
	}
	
	main(){
		var a;
		a = foo();
	}
\end{lstlisting}


\subsection{Breytur}

Fyrsta gildisveitinginn sem á sér stað er þegar breyta er búinn til , þá mun hún innihalda null gildið. Seinna meir í stofni falls er hægt að gefa henni nýtt gildi. Notkunardæmi er hér fyir neðan. Breytunöfn verða hafa a.m.k. einn bókstaf í sér og geta innihaldið tölur.

\begin{lstlisting}
	main(){
		var a;	;;; a = null
		a = 0;  ;;; a = 0
	}
\end{lstlisting}


\subsection{Merking segða}
\subsubsection{null-segð}
Þjónar þeim tilgangi að sýna fram á að breyta hafi ekki verið gefið neitt gildi.
\subsubsection{true-false segð}
Boolean gildi true notað í boolean reikningi.
\subsubsection{false-segð}
Boolean gidli false notað í boolean reikningi.
\subsubsection{Heiltölusegð}
Heiltölu gildi.
\subsubsection{Fleytitölusegð}
Fleititölu gildi.
\subsubsection{Stafsegð}
Stafsegðar gildi 's'.
\subsubsection{Strengsegð}
Strengsegðar gildi "Strengsegð".
\pagebreak
\subsubsection{return-segð}
Return skilar gildi úr falli. Notkunardæmi:
\begin{lstlisting}
	foo(){
		return 1;	;;; Skilar 1 ef kallað er á
	}	
	
\end{lstlisting}
\subsubsection{Röksegðir}
Röksegðir eru  or ||, and \&\&, !=, >=, <= og == .\\
Þær eru að mestu leiti reiknaðar frá vinstri til hægri. Notkunardæmi:

\begin{lstlisting}
				;;; gefur 
	1 != 2 			;;; true
	true || false 		;;; true
	true && true 		;;; true
	1 >= 1			;;; true
	1 <= 1			;;; true
	1 == 1			;;; true
\end{lstlisting}
\subsubsection{Kallsegð}
Fall eru annað hvort úr basis eða gert af notenda. Fall tekur inn breytur sem viðföng og reikningur úr þeim er frá vinstri til hægri. Dæmi um slíkt fall sem notendi getur gert og notkun:
\begin{lstlisting}
	foo(a,b,s){
		var t;
		return 1;
	}
	
	main(){
		var x;
		x = foo(1+1,2-5,-3);	;;; foo fall skilar einum
	}
\end{lstlisting}

\subsubsection{Tvíundaraðgerðir}
Tvíundaraðgerðir eru á infix formi.
\subsubsection{Einundaraðgerðir}
Einundaraðgerðir hafa hæsta forgang.
\pagebreak
\subsubsection{if-segð}
Hér er dæmi um notkun á if elsif else segðum. Ef s1 er satt þá body1. Ef s1 ósatt og s2 satt þá body2. Ef s1 og s2 ósatt þá body3.
\begin{lstlisting}
	main(){
		var s1,s2,s3;
		if(s1){
			;;; body1		
		} elsif (s2) {
			;;; body2
		} else {
			;;; body3		
		};
	}
\end{lstlisting}
\subsubsection{while-segð}
while-segðin mun alltaf keyrast ef ástandið s1 helst satt. Dæmi um while-segð. Í gefni while-segð ef röksegðini s1 helst sönn þá mun fyrir hvert stef í while lykkju i hækka um einn.

\begin{lstlisting}
	main(){
	var i;
	i = 0;
	while(s1){
		i = i + 1;		
	};
	}
\end{lstlisting}
\subsection{Föll og forrit}
Hér er dæmi um heilt NanoMorpho forrit. Þetta forrit reiknar fyrstu 12 Fibonacci tölurnar.

\begin{lstlisting}
;;; Fibonacci
	fibo(n){
  		var ;
  		if(n < 0) {
    		return n * -1; 
  		} elsif( n == 0) { 
    		return n * ( 1 - 2);
  		} else {
    		return fibo(n-1) + fibo(n-2);
  		};
	}
	main(){
  		var n;
  		n = 0;
  		while(n < 12){
    			n = n+1;
    			println(fibo(n)); }; } 
\end{lstlisting}

\end{document}
