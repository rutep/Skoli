# Fyrirlestur 9.1

## React #2

### Vefforritun 2 ‚Äî HBV403G

#### √ìlafur Sverrir Kjartansson, [osk@hi.is](mailto:osk@hi.is)

---

## B√∫um til klukku

Hvernig b√∫um vi√∞ til klukku √≠ React?

```javascript
function tick() {
  const element = (
    <p>{new Date().toLocaleTimeString()}</p>
  );
  ReactDOM.render(
    element,
    document.getElementById('root')
  );
}
setInterval(tick, 1000);
```

***

## A√∞skiljum klukku fr√° render

```javascript
function Clock(props) {
  return (
    <p>{props.date.toLocaleTimeString()}</p>
  );
}
function tick() {
  ReactDOM.render(
    <Clock date={new Date()} />,
    document.getElementById('root')
  );
}
setInterval(tick, 1000);
```

***

## √ûetta er ekki endurn√Ωtanlegt

* Viljum a√∞ klukkan sj√°i sj√°lf um st√∂√∞u s√≠na
* √ötf√¶rslu atri√∞i hvort vi√∞ notum `setInterval` e√∞a eitthva√∞ anna√∞
* √ûurfum `state` fyrir component

***

## State

* Keiml√≠kt `props` en er pr√≠vat fyrir component
* Stj√≥rna√∞ af component a√∞ √∂llu leiti
* A√∞eins til sta√∞ar ef component skilgreint sem `class`
* √Üttum a√∞eins a√∞ setja hluti sem ver√∞a birtir √≠ `state`, √∂nnur g√∂gn getum vi√∞ geymt √° `class` me√∞ `this`

***

## Byrjunarsta√∞a

* Setjum `this.state = { ... }` √≠ `contstructor`
* Ef vi√∞ h√∂fum stu√∞ning vi√∞ member breytur sem `state = { ... }` √≠ class (virkar √≠ CRA)
* **Eina skipti√∞** sem vi√∞ setjum `state` beint

***

```javascript
class Foo extends Component {
  constructor(props) {
    super(props);
    this.state = { /* ... */ };
  }
}
```

```javascript
class Foo extends Component {
  state = { /* ... */ };
}
```

***

## Uppf√¶rsla √° `state`

* Uppf√¶rsla √° `state` fer alltaf fram √≠ gegnum `this.setState()`
* Uppf√¶rslur eru keyr√∞ar asynchronously, getum ekki treyst √° a√∞ uppf√¶rsla hafi √°tt s√©r sta√∞ √≠ n√¶stu l√≠nu
* Ef vi√∞ viljum b√≠√∞a eftir a√∞ b√∫i√∞ s√© a√∞ setja `state` getum vi√∞ nota√∞ `this.setState((prevState, props) => { /* ... */ })`
* Getum uppf√¶rt einn hlut √≠ st√∂√∞u √≠ einu, √æurfum ekki a√∞ uppf√¶ra allt √≠ einu

***

```javascript
// üëéüèº
this.state.comment = 'Hello';
```

```javascript
/ üëçüèº
this.setState({ comment: 'Hello' });
```

***

```javascript
// üëéüèº
this.setState({
  counter: this.state.counter + this.props.incr,
});
```

```javascript
//  üëçüèº
this.setState((prevState, props) => ({
  counter: prevState.counter + props.incr,
}));
```

***

```javascript
class Foo extends Component {
  state = {
    posts: [],
    comments: [],
  }

  foo() {
    fetchPosts().then(r => {
      this.setState({ posts: r.posts });
    });

    fetchComments().then(r => {
      this.setState({ comments: r.comments });
    });
  }
}
```

***

## Fl√¶√∞i gagna

* Componentum √° a√∞ vera alveg sama hvort a√∞rir componentar hafi st√∂√∞u e√∞a ekki; s√©u functional e√∞a ekki
* `state` er h√°√∞ √∫tf√¶rslu component og er aldrei a√∞gengilegt √∂√∞rum componentum
  - Nema component sendi part af st√∂√∞u √°fram √≠ _prop_ hj√° √∂√∞rum component

***

## G√∂gn fl√¶√∞a ni√∞ur

* G√∂gn √≠ react fl√¶√∞a alltaf _ni√∞ur_
  - _top-down_ e√∞a _unidirectional_ gagnafl√¶√∞i
* √ûetta vefst fyrir m√∂rgum sem byrja a√∞ nota react

***

```javascript
class Clock extends React.Component {
  state = { date: new Date() }

  render() {
    return (
      <p>{this.state.date.toLocaleTimeString()}</p>
    );
  }
}
```

L√©leg klukka, h√∫n uppf√¶rist ekki...

---

## Lifecycle methods

* Lifecycle methods/hooks eru √æa√∞ sem vi√∞ notum til a√∞ breg√∞ast vi√∞ breytingum √° ‚Äûl√≠fi‚Äú component
  - Er b√∫i√∞ a√∞ b√∫a component til √≠ DOM? Er veri√∞ a√∞ fjarl√¶gja hann? Var component a√∞ f√° n√Ω prop? O.s.fr.
* Leyfir okkur a√∞ keyra k√≥√∞a og gera uppf√¶rslur √° st√∂√∞u e√∞a skila uppl√Ωsingum um component √° hverjum t√≠mapunkti

***

## componentDidMount

* `componentDidMount` keyrir √æegar b√∫i√∞ er a√∞ setja component upp √≠ DOM
* Getum brug√∞ist vi√∞ me√∞ √æv√≠ a√∞ b√∫a til timera, s√¶kja g√∂gn o.√æ.h.
* Keyrir _a√∞eins_ √° client

***

## componentWillUnmount

* `componentWillUnmount` keyrir √°√∞ur en component ver√∞ur fjarl√¶g√∞ur √∫r DOM
* Hreinsum til eftir okkur, fjarl√¶gjum timers og event handlers ef einhverjir

***

```javascript
componentDidMount() {
  this.timerID = setInterval(
    () => this.tick(),
    1000
  );
}

componentWillUnmount() {
  clearInterval(this.timerID);
}

tick() {
  this.setState({
    date: new Date()
  });
}
```

***


## componentWillReceiveProps

* `componentWillReceiveProps(nextProps)` er keyrt √æegar `props` eru uppf√¶r√∞
* Getum n√°lgast n√∫verandi `props` me√∞ `this.props`
* T√¶kif√¶ri til a√∞ uppf√¶ra `state` m.v. n√Ω `props`
* Getur keyrt √æ√≥ engin `props` hafi uppf√¶rst

***

## shouldComponentUpdate

* `shouldComponentUpdate(nextProps, nextState)` er lei√∞ fyrir okkur til a√∞ tilgreina hvort component eigi a√∞ uppf√¶rast og √æar me√∞ rendera aftur
* Lang oftast viljum vi√∞ ekki eiga vi√∞ √æetta
* Ef vi√∞ eigum vi√∞ er √æa√∞ til a√∞ koma √≠ veg fyrir a√∞ d√Ωr component s√© rendera√∞ur of oft

***

## PureComponent

* Ef vi√∞ h√∂fum einfaldan component getum vi√∞ l√°ti√∞ hann erfa fr√° `React.PureComponent` √≠ sta√∞inn fyrir `React.Component`
* √ötf√¶rir `shouldComponentUpdate` sem _shallow_ samanbur√∞ √° `props` og `state`

***

## Og fleiri

* [`componentWillMount`](https://reactjs.org/docs/react-component.html#componentwillmount)
* [`componentWillUpdate`](https://reactjs.org/docs/react-component.html#componentwillupdate)
* [`componentDidUpdate`](https://reactjs.org/docs/react-component.html#componentdidupdate)

---

## Atbur√∞ir √≠ react

* Atbur√∞ir √≠ react eru svipa√∞ir DOM atbur√∞um me√∞ sm√° undantekningum
* camelCase og f√∂ll en ekki strengir
* `<button onclick="activateLasers()">` VS `<button onClick={activateLasers}>`
* üò±

***

```javascript
function ActionLink() {
  function handleClick(e) {
    e.preventDefault();
    console.log('The link was clicked.');
  }

  return (
    <a href="#" onClick={handleClick}>
      Click me
    </a>
  );
}
```

***

## A√∞ taka √æ√°tt √≠ atbur√∞um

* √ç react √æurfum vi√∞ yfirleitt ekki a√∞ nota `addEventListener`
* React notar _synthetic events_, ekki _alv√∂ru_ event fr√° browser
* Skr√°um handler beint √≠ JSX og react s√©r um

***

## Synthetic event

* React √∫tf√¶rir eigin events √∫tfr√° W3C spec
  - Getum nota√∞ `e.stopPropagation()` og `e.preventDefault()`
* Endurn√Ωtir events og gerir √Ωmislegt til a√∞ f√° betra performance
* [React: SyntheticEvent](https://reactjs.org/docs/events.html)

***

## Binding

* √ûa√∞ er algengt a√∞ nota class method √æegar vi√∞ skr√°um handler √° class
* Ver√∞um a√∞ passa a√∞ _binda_ r√©tt til √æess a√∞ `this` virki
* Nokkrar lei√∞ir √≠ bo√∞i

***

## Binding lei√∞ir

* Binda √≠ `constructor`
  - `this.handleClick = this.handleClick.bind(this);`
  - Frekar fyrirfer√∞armiki√∞
* Binda √≠ event
  - `<button onClick={(e) => this.handleClick(e)}>`
  - Veldur √æv√≠ a√∞ fyrir hvert `render` er b√∫i√∞ til n√Ωtt fall

***

* Nota public class field (ekki or√∞i√∞ sta√∞la√∞)
  - `handleClick = () => { /* ... */ }`
  - √û√¶gileg lei√∞ sem er studd af CRA
  - M√¶li me√∞ a√∞ nota √æessa

***

```javascript
class Foo extends Component {
  handleClick = (e) => {
    console.log(this, e);
  }

  render() {
    return (
      <p>
        <button onClick={this.handleClick}>
          click
        </button>
      </p>
    );
  }
}
```

***

## Argument √≠ event handler

* Til a√∞ senda g√∂gn √≠ event handler getum vi√∞ nota√∞
  - `<button onClick={(e) => this.del(id, e)}>Delete</button>`
  - `<button onClick={this.del.bind(this, id)}>Delete</button>`
  - B√Ωr til n√Ωtt fall vi√∞ hver render...
* E√∞a vi√∞ getum √∫tb√∫i√∞ handler sem skilar _√∂√∞rum_ handler

***

```javascript
handler = (foo) => {
  return (e) => {
    e.preventDefault();

    // foo er a√∞gengilegt √æegar
    // atbur√∞ur √° s√©r sta√∞
  }
}

// ...

return (<button onClick={this.handler('foo')});
```

---

## Ajax

* A√∞ s√¶kja g√∂gn er ekki √≥svipa√∞ √æv√≠ sem vi√∞ h√∂fum n√∫ √æegar gert me√∞ `fetch`
  - [Stutt √≠ √∂llum n√Ωlegum browserum](https://caniuse.com/#feat=fetch)
* Getum nota√∞ `async await` me√∞ CRA üéâ
  - K√∂llum yfirleitt √≠ g√∂gn √∫r `componentDidMount` svo vi√∞ merkjum √æa√∞ sem `async`

***

## St√∂√∞ur √° g√∂gnum

* √Üttum a√∞ me√∞h√∂ndla √ærj√°r st√∂√∞ur:
  - Loading: veri√∞ a√∞ s√¶kja g√∂gn
  - Error: eitthva√∞ kom upp vi√∞ a√∞ s√¶kja g√∂gn
  - Success: g√∂gn s√≥tt og birt

***

```javascript
class Fetch extends Component {
state = { data: null, loading: true, error: false }

async componentDidMount() {
  try {
    const data = await this.fetchData();
    this.setState({ data, loading: false });
  } catch (e) {
    this.setState({ error: true, loading: false });
  }
}
async fetchData() {
  const response = await fetch(url);
  const data = await response.json();
  return data;
}
```

***

```javascript
  render() {
    const { data, loading, error } = this.state;

    if (loading) {
      return (<div>S√¶ki g√∂gn...</div>);
    }

    if (error) {
      return (<div>Villa vi√∞ a√∞ s√¶kja g√∂gn</div>);
    }

    return (<div>G√∂gn: {data}</div>);
  }
}
```

---

## Form √≠ react

* Form element sj√° um sitt eigi√∞ state:
  - Ef vi√∞ sl√°um inn staf √≠ `<input>` heldur √æa√∞ utan um stafinn og alla sem fylgja
* Passar ekki vi√∞ `state` √≠ react, viljum a√∞ einhver react component haldi utan um st√∂√∞u

***

* Getum stj√≥rna√∞ st√∂√∞u √≠ react me√∞ √æv√≠ a√∞ binda fall vi√∞ form element og geyma st√∂√∞u √æess √≠ `state`
  - React ver√∞ur ‚Äûsingle source of truth‚Äú
  - ‚ÄûControlled component‚Äú
* Ef vi√∞ h√∂ldum ekki utan um st√∂√∞u √≠ react erum vi√∞ a√∞ nota _uncontrolled component_

***

```javascript
class NameForm extends React.Component {
  state = { value: '' }
  handleChange = (e) => {
    this.setState({value: e.target.value});
  }
  handleSubmit = (e) => {
    e.preventDefault();
    alert(this.state.value);
  }
  render() {
    return (
    <form onSubmit={this.handleSubmit}>
      <input type="text"
      value={this.state.value}
      onChange={this.handleChange} />
      <input type="submit" value="Submit" />
    </form>
    );
  }
}
```

***

* `handleChange` keyrir fyrir _hvern_ innsl√°tt √≠ `<input>`
* T√∂luvert √∂√∞ruv√≠si en √°n react
  - √ûurfum ekki a√∞ lesa gildi √∫r reit √° einhverjum t√≠mapunkti
  - Vitum alltaf st√∂√∞u og getum stoppa√∞ strax ef t.d. ekki valid g√∂gn

***

## textarea

* Efni √≠ `<textarea>` er skilgreint af b√∂rnum √æess en √≠ react f√¶r √æa√∞ `value` attribute
* `<textarea value={this.state.value} onChange={this.handleChange} />`

***

## select

* Sama me√∞ `<select>`, vali√∞ `<option>` er skilgreint sem `value` √° `<select>`
* Getum vali√∞ m√∂rg me√∞ `<select multiple={true} value={['B', 'C']}>`
* √ûetta samr√¶mir API √° `<input>`, `<textarea>` og `<select>`

***

```javascript
render() {
  return (
    <form onSubmit={this.handleSubmit}>
      <label>
        Velja:
        <select value={this.state.value} onChange={this.handleChange}>
          <option value="foo">Foo</option>
          <option value="bar">Bar</option>
        </select>
      </label>
      <input type="submit" value="Submit" />
    </form>
  );
}
```

***

## Margir reitir

* √ûegar vi√∞ h√∂fum marga reiti √≠ sama formi getur k√≥√∞i fari√∞ √∫r b√∂ndunum
* Getum n√Ωtt okkur `name` attribute √° reit til a√∞ gera almennan handler
  - Fyrir s√©rstaka virkni getum vi√∞ s√≠√∞an alltaf skrifa√∞ spes

***

```javascript
handleInputChange(event) {
  const target = event.target;
  const value = target.type === 'checkbox' ?
    target.checked : target.value;
  const name = target.name;

  this.setState({ [name]: value });
}

return (
  <input type="text"
    name="foo"
    value={this.state.foo}
    onChange={this.handleInputChange}
  />
);
```

---

## react-router

* [`react-router`](https://reacttraining.com/react-router/) er samansafn af components sem leyfa okkur a√∞ skilgreina lei√∞arkerfi √≠ react
* Notar declarative API og _dynamic_ routing
* Virkar √° vef og √≠ react native
* S√¶kjum `react-router-dom`
  - `npm install --save react-router-dom`

***

## Dynamic routing

* Flest routing kerfi eru static: vi√∞ skilgreinum routes √≠ k√≥√∞a og √æegar forrit byrjar eru √æau route √≠ bo√∞i
  - T.d. √≠ Express
* Me√∞ dynamic routing eru route skilgreind √° keyrslu t√≠ma og vi√∞ getum brug√∞ist vi√∞ √æ√°
* Route er skilgreint me√∞ component sem h√¶gt er a√∞ rendera h√©r og √æar, hven√¶r sem er

***

```javascript
const App = () => (
  <div>
    <nav>
      <Link to="/dashboard">Dashboard</Link>
    </nav>
    <Route
      path="/dashboard"
      component={Dashboard}
    />
  </div>
);
```

***

## Components

React router hefur √ærj√° grunn ger√∞ir componenta sem vi√∞ s√¶kjum √∫r `react-router-dom`

* Routers, grunn component sem umlykur allt forrit, notum `<BrowserRouter>`
* Route matching, componentar sem bregast vi√∞ sl√≥√∞ og birta eitthva√∞, vi√∞ notum `<Route>` og `<Switch>`
* Navigation, componentar sem b√∫a til linka sem react-router skilur, notum `<Link>` og `<NavLink>`

***

## BrowserRouter

* [`<BrowserRouter>`](https://reacttraining.com/react-router/web/api/BrowserRouter) notar HTML history API til a√∞ halda vi√∞m√≥ti √≠ samr√¶mi vi√∞ URL
* L√°tum umlykja allt forrit, t.d. `<App>`

***

```javascript
import { BrowserRouter } from 'react-router-dom'

<BrowserRouter>
  <App/>
</BrowserRouter>
```

***

## Route

* `<Route>` virkar svipa√∞ og routes √≠ express, gefum `path` attribute sem bori√∞ ver√∞ur saman vi√∞ URL (`location.pathname`)
  - √Ån `path` matchar `<Route>` alltaf
  - Getum skrifa√∞ regex og n√°lgast s√≠√∞an √≠ component sem ver√∞ur birtur
  - Ef vi√∞ setjum `exact` attribute ver√∞ur URL a√∞ vera n√°kv√¶mlega √æa√∞ sem `path` er

***

* Me√∞ `component` attribute skilgreinum vi√∞ hva√∞a component √° a√∞ birta ef URL passar vi√∞ `<Route>`
* Einnig h√¶gt a√∞ nota [_render props_](https://reactjs.org/docs/render-props.html) til a√∞ senda auka g√∂gn me√∞ √≠ component

***

```javascript
import { Route } from 'react-router-dom'

// when location = { pathname: '/about' }
<Route
  path='/about'
  component={About}
/> // renders <About/>

<Route
  path='/contact'
  component={Contact}
/> // renders null

<Route component={Always}/> // renders <Always/>
```

***

## Switch

* Notum `<Switch>` til a√∞ h√≥pa saman `<Route>` og birta eing√∂ngu eitt, √æa√∞ fyrsta sem passar
* Handh√¶gt til a√∞ stj√≥rna √° √æv√≠ hva√∞a s√≠√∞ur eigi a√∞ birta
* Setjum `404` route seinast

***

```javascript
import { Switch, Route } from 'react-router'

<Switch>
  <Route exact path="/" component={Home}/>
  <Route path="/about" component={About}/>
  <Route path="/:user" component={User}/>
  <Route component={NotFound}/>
</Switch>
```

***

## Route props

* Component sem er birtur me√∞ `<Route>` mun f√° [_route props_](https://reacttraining.com/react-router/web/api/Route/route-props)
  - [`match`](https://reacttraining.com/react-router/web/api/match) sem geymir uppl√Ωsingar um hvernig var matcha√∞, getum s√≥tt params √æanga√∞: `match.params.user`
  - [`location`](https://reacttraining.com/react-router/web/api/location) segir til um hvar vi√∞ erum, `location.pathname` er sl√≥√∞, `location.search` er querystring
  - [`history`](https://reacttraining.com/react-router/web/api/history) heldur utan um `history` hlut

***

## Link

* [`<Link to="url">`](https://reacttraining.com/react-router/web/api/Link) notum vi√∞ √≠ sta√∞inn fyrir `<a>` til a√∞ b√∫a til linka
* react-router s√©r √æ√° um a√∞ vi√∞halda st√∂√∞u og gera sitt
* [`<NavLink>`](https://reacttraining.com/react-router/web/api/NavLink) er s√©rtilvik sem vi√∞ getum sett `class` e√∞a `style` √° √æegar `to` passar vi√∞ s√≠√∞u

***

## Scroll restoration

* Me√∞ √æv√≠ a√∞ nota react-router erum vi√∞ a√∞ l√°ta forrit sj√° um √æa√∞ hvernig browsa√∞ er √≠ gegnum vefinn okkar
  - Teki√∞ fram yfir `back` og `forward` virkni √≠ vafra
* [Scroll restoration](https://reacttraining.com/react-router/web/guides/scroll-restoration) er √æegar sta√∞a √° s√≠√∞u vi√∞helst √° milli √æess sem vi√∞ f√∂rum fram og til baka
  - Vafrar farnir a√∞ √∫tf√¶ra me√∞ `history` en react router s√©r _ekki_ um fyrir okkur
* Getum √∫tf√¶rt [‚Äûscroll-to-top‚Äú](https://reacttraining.com/react-router/web/guides/scroll-restoration/scroll-to-top) virkni sem leysir stundum m√°li√∞

***

## N√°nar um react-router

* `react-router` getur gert t√∂luvert fl√≥knari hluti
  - Birt hluta af vef √∫tfr√° √æv√≠ hvar vi√∞ erum, t.d. modal glugga
  - Gefi√∞ fleiri hlutum URL
  - Leyft okkur a√∞ √∫tf√¶ra _page transitions_
  - [Slatti af d√¶mum](https://reacttraining.com/react-router/web/example/basic)

---

## react-helmet

* [`react-helmet`](https://github.com/nfl/react-helmet) er component sem s√©r um breytingar √° efni √≠ `<head>`
  - Getur l√≠ka breytt attributes √° `<html>` og `<body>`
* Hva√∞a component sem er √≠ tr√©nu getur nota√∞ og breytt
  - Au√∞veldar t.d. a√∞ setja `<title>` per s√≠√∞u

***

* Breytum metadata declarative!
* Fyrir `title` getum vi√∞ skilgreint `titleTemplate` sem streng me√∞ `%s` sem ver√∞ur skipt √∫t fyrir annan title
  - Getum l√≠ka skilgreint `defaultTitle` sem er sett ef ekkert er sett

***

```javascript
import Helmet from 'react-helmet';

function App() {
  return (<Helmet
      defaultTitle="Foo√æj√≥nustan"
      titleTemplate="%s ‚Äì Foo√æj√≥nustan"
    />);
}

function Page() {
  return (<Helmet title="Um okkur" />);
}
```

***

```javascript
import Helmet from 'react-helmet';

//...

<Helmet title="Hall√≥ heimur">
  <html lang="is" />
  <body className="foo" />
</Helmet>
```

---

## create-react-app og Heroku

* Eftir sm√≠√∞i √° okkar fyrsta react vef er til g√≥√∞ skj√∂lun um hvernig vi√∞ getum komi√∞ upp √° mismunandi h√Ωsingum
  - [Deployment](https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/template/README.md#deployment)
* Til a√∞ setja upp √° Heroku √æurfum vi√∞ _buildpack_ sem inniheldur √æau skref sem √æarf a√∞ framkv√¶ma
  - [Heroku Buildpack for create-react-app](https://github.com/mars/create-react-app-buildpack)
  - [Deploying React with Zero Configuration](https://blog.heroku.com/deploying-react-with-zero-configuration)

***

```bash
npm install -g create-react-app
create-react-app my-app
cd my-app
git init
heroku create -b https://github.com/mars/create-react-app-buildpack.git
git add .
git commit -m "react-create-app on Heroku"
git push heroku master
heroku open
```
