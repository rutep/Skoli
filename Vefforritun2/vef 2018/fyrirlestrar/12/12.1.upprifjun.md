# Fyrirlestur 12.1

## Upprifjun

### Vefforritun 2 ‚Äî HBV403G

#### √ìlafur Sverrir Kjartansson, [osk@hi.is](mailto:osk@hi.is)

---

## Node.js

* Verkvangur (platform) bygg√∞ur √° V8 til a√∞ sm√≠√∞a hr√∂√∞, skalanleg netforrit
* Notar atbur√∞adrifi√∞, ekki-blokkandi I/O m√≥del sem gerir √æa√∞ l√©tt, skilvirkt og fullkomi√∞ fyrir raunt√≠ma forrit sem me√∞h√∂ndla mikil g√∂gn yfir dreif√∞ kerfi
 Notum til a√∞ b√∫a til allskonar forrit, b√¶√∞i _bakenda_, _CLI_ o.fl.

***

## node og ECMAScript 6

* N√Ωjustu √∫tg√°fur af node hafa [99% stu√∞ning vi√∞ ECMASCript 6](http://node.green/)
* Getum √æv√≠ nota√∞ allt n√Ωja d√≥ti√∞ √°n √æess a√∞ _transpilea_ √° _server_
* Fyrir enn n√Ωrri virkni (ECMAScript 2016+) getum vi√∞ √æ√≥ sett upp Babel (e√∞a √°l√≠ka) og _transpilea√∞_

***

## Atbur√∞adrifi√∞

* Node.js forrit eiga a√∞ vera atbur√∞adrifin ‚Äì erfitt a√∞ skrifa √æau ekki √æannig
* Gefum upp _callback_ fall fyrir hluti sem taka t√≠ma, kalla√∞ √≠ √æa√∞ √æegar a√∞ger√∞ kl√°rast
* Allar a√∞ger√∞ir √≠ core sem gera eitthva√∞ √≠ lengri t√≠ma taka vi√∞ callback

***

## Promises

* node hefur stu√∞ning vi√∞ promises sem gerir √æa√∞ au√∞veldara a√∞ vinna me√∞ async k√≥√∞a
* Fr√° og me√∞ √∫tg√°fu 8 getum vi√∞ nota√∞ `util.promisify` til a√∞ breyta callback API √≠ promise API
  - üòç

***

## async og await

* K√≥√∞inn okkar ver√∞ur t√∂luvert grynnri og l√¶silegri
* Notum `try catch` fyrir villume√∞h√∂ndlun
* `async` f√∂ll skila promises! √ûurfum a√∞ gr√≠pa yst, annars getum vi√∞ misst af villum

***

## NPM

* Heeeellingur til af NPM m√≥d√∫lum/p√∂kkum sem geta einfalda√∞ okkur l√≠fi√∞
* S√¶kjum me√∞ `npm install <module> --save` og tilgreinum √æannig a√∞ forriti√∞ okkar √æarfnist √æessa pakka
  - Skilgreinum _dependency_ √° pakkann
  - Vista√∞ √≠ `package.json` √°samt √∫tg√°fun√∫meri

***

## NPM √≥kostir

* En hefur NPM √≥kosti?
* Seinustu √°r hafa komi√∞ upp atvik √æar sem pakkar hafa horfi√∞ √∫r NPM og haft √°hrif √° _√æ√∫sundir_ verkefna
* Getur veri√∞ varasamt a√∞ taka √° sig of m√∂rg dependancy

---

## Einingar

* Getum og _√¶ttum a√∞_ skipta forritunum okkar upp √≠ einingar
* Me√∞ √æv√≠ ver√∞ur...
  - au√∞veldara er a√∞ hugsa um forriti√∞
  - au√∞veldara a√∞ vinna me√∞ _fl√¶kjustig_
* Node.js kemur me√∞ nokkrum einingum
  - Getum s√≥tt a√∞rar gegnum NPM
  - E√∞a skrifa√∞ okkar eigin

***

## Einingar √≠ node

* Einingakerfi√∞ √≠ node byggir √° [CommonJS](http://www.commonjs.org/specs/modules/1.0/)
  - Var√∞ til √æegar f√≥lk f√≥r a√∞ nota JavaScript utan vafra og √æurfti lei√∞ til a√∞ pakka saman virkni
  - Hle√∞ur einingum _synchronously_
* Sn√Ωst um a√∞ _exporta_ g√∂gnum √∫r einingum og s√¶kja me√∞ `require`

***

## module.exports

* Til a√∞ veita a√∞gang a√∞ virkni √≠ einingu √æurfum vi√∞ a√∞ _exporta_ einhverju
* Gerum √æa√∞ me√∞ √æv√≠ a√∞ skilgreina hva√∞a gildi sem er √° `module.exports`
  - `module.exports = 1;` ‚Äì Gildinu `1` er skila√∞ √∫r module
  - `module.exports = () => {};` ‚Äì falli skila√∞
  - `module.exports = { foo: 'bar' };` ‚Äì hlut skila√∞

***

## require

* Notum pakka me√∞
  - `const pakki = require('<nafn-√°-pakka>');`
* Ef engin ending er skilgreind er gert r√°√∞ fyrir a√∞ skr√° innihaldi JavaScript
* Ef ending er `json` eru json g√∂gn √≠ skr√° √æ√°ttu√∞ og √æeim skila√∞

***

## import og export

* ECMAScript 2015 skilgreinir a√∞ra lei√∞ me√∞ _import_ og _export_
  - Almennt ekki kominn n√≥gu g√≥√∞ur stu√∞ningur
* Node 9.4 hefur _experimental_ stu√∞ning ef vi√∞ keyrum
  - `node --experimental-modules file.mjs`
  - Skr√°r ver√∞a a√∞ hafa endinguna `mjs` til a√∞ geta nota√∞
* Fl√≥ki√∞ √æv√≠ _import_ _export_ hle√∞ur einingum _asynchronously_

---

## Express

* [Web app framework](http://expressjs.com/) fyrir node
* Sm√°tt √≠ sni√∞um en gefur mikla m√∂guleika √° a√∞ b√¶ta vi√∞ virkni til a√∞ gera h√©rumbil hva√∞ sem er
* `npm install express --save`

***

## [Request hluturinn](http://expressjs.com/en/4x/api.html#req)

* `req` stendur fyrir HTTP request sem kemur fr√° client
  - Getum sk√Ωrt anna√∞ (t.d. `request` e√∞a `foo`) me√∞ √æv√≠ a√∞ sk√Ωra argument anna√∞
* Hefur b√¶√∞i eigindi og f√∂ll

***

## [Response hluturinn](http://expressjs.com/en/4x/api.html#res)

* `res` stendur fyrir HTTP response sem vi√∞ erum a√∞ skila til client
* Hefur b√¶√∞i eigindi og f√∂ll

***

## Route

* Express hefur [stu√∞ning vi√∞ routing](http://expressjs.com/guide/routing.html)
* _Route_ eru sl√≥√∞ (URI) sem forriti√∞ okkar svarar bei√∞num fr√° client √°
* Samanstendur af URI, HTTP a√∞fer√∞ og einum e√∞a fleirum f√∂llum
  - `app.METHOD(URI, callback)`
  - Margar HTTP a√∞fer√∞ir til, en vi√∞ notum a√∞ mestu `get` og `post`
  - `all` er h√¶gt a√∞ nota til a√∞ svara fyrir _allar a√∞fer√∞ir_

***

## Middleware √≠ Express

* Hefur a√∞gang a√∞ request og response hlutum og _n√¶sta_ middleware
  - `function middleware(req, res, next)`
* Getur
  - Keyrt k√≥√∞a
  - Breytt `req` e√∞a `res`
  - Enda√∞ request-response keyrslu
  - Kalla√∞ √≠ n√¶sta middleware

***

## Villume√∞h√∂ndlun

* Vi√∞ skilgreinum villume√∞h√∂ndlunar middleware me√∞ auka argument
  - `function (err, req, res, next)`
* Skilgreind seinast √≠ app, √° eftir √∂llum √∂√∞rum middleware
* S√©r um a√∞ taka til, logga villu, senda notanda villuskilabo√∞ o.sfr.

***

## 404 villur

* Getum n√Ωtt okkur middleware til √æess a√∞ gr√≠pa 404 villur
  - Veri√∞ a√∞ reyna a√∞ opna route sem vi√∞ h√∂fum ekki skilgreint
* Setjum middleware √° _eftir_ √∂llum routes sem vi√∞ vitum a√∞ muni a√∞eins keyra ef ekkert hefur sent reponse
  - En samt √° undan villume√∞h√∂ndlun

***

## Template √≠ Express

* S√¶kjum √∫tf√¶rslu √° template m√°li fyrir Express
* Skilgreinum √° `app` hva√∞a template m√°l vi√∞ notum og hvar template eru geymd
  - `app.set('view engine', 'ejs');`
  - `app.set('views', path.join(__dirname, 'views'));`
* `res.render(template, data)` notar skilgreindar template v√©l til a√∞ birta `template` me√∞ `data`

---

## Request‚Äîresponse

* HTTP byggir √° request‚Äîresponse milli client og server
* Client sendir request √° server
* Server framkv√¶mir a√∞ger√∞ir og sendir response √° client

***

## Request

* Request er:
  - Request line: a√∞fer√∞ (e√∞a s√∂gn) sem notu√∞ er, au√∞lind og √∫tg√°fu af HTTP
  - Headers fyrir a√∞ger√∞
  - T√≥m l√≠na
  - Hugsanlega g√∂gn

***

## Response

* Response er:
  - Status l√≠na: √∫tg√°fa af HTTP, sta√∞a sem tala og sta√∞a sem texti
  - Headers fr√° √æj√≥ni
  - T√≥m l√≠na
  - Hugsanlega g√∂gn

***

## URI

* Skilgreint √≠ [RFC 3986](https://www.ietf.org/rfc/rfc3986.txt)
* Uniform Resource Identifier ‚Äì strengur sem skilgreinir au√∞lind
  - Me√∞ nafni, sta√∞setningu e√∞a b√¶√∞i
  - _Au√∞lind_ er einhver eining sem vi√∞ viljum n√°lgast, t.d. HTML skjal, mynd

***

## URN og URL

* URN ‚Äì Uniform Resource Name, skilgreinir au√∞lind me√∞ _nafni_, t.d. ISBN n√∫mer
* URL ‚Äì Uniform Resource Locator, skilgreinir au√∞lind me√∞ _sta√∞setningu_

***

## HTTP a√∞fer√∞ir og `<form>`

* √ûegar vi√∞ b√∫um til `<form>` getum vi√∞ skilgreint hvort vi√∞ notum `GET` e√∞a `POST` me√∞ `method` attribute
* `<form method="get">` sendir g√∂gn me√∞ `GET` og setur allar breytur √≠ query-string, t.d. `http://example.org/?foo=bar`
* `<form method="post">` sendir g√∂gn me√∞ `POST` og setur allar breytur √≠ _request body_

***

## body-parser middleware

* Vesen a√∞ vinna me√∞ `POST` g√∂gn gegnum straum √≠ hvert skipti
* Express 4.16+ hefur `urlencoded` parser middleware til a√∞ vinna me√∞ `application/x-www-form-urlencoded` g√∂gn

***

## Unni√∞ me√∞ g√∂gn

* √ûegar vi√∞ t√∂kum vi√∞ g√∂gnum √∫r formi er √æa√∞ yfirleitt frekar mikil handavinna
* Ver√∞um a√∞ sta√∞festa a√∞ g√∂gn s√©u gild √° bakenda!
  - Ekki n√≥g a√∞ nota `<input required>` e√∞a JavaScript √° framenda
* Passa upp √° a√∞ g√∂gn s√©u _hrein_
  - Treystum engu fr√° notanda! T√∫lkum √∂ll g√∂gn sem √≥hrein (dirty) √æar til hreinsu√∞ (sanitized)

---

## [PostgreSQL](https://en.wikipedia.org/wiki/PostgreSQL)

* E√∞a bara _postgres_
* Open source gagnagrunnur sem er mj√∂g √∫tbreiddur og miki√∞ nota√∞ur
* _Object-relational database management system_ (ORDBMS), sty√∞ur classes, erf√∞ir beint
* ACID og √∫tf√¶rir mest allan SQL sta√∞alinn

***

## Postgres og Node.js

* [node-postgres](https://github.com/brianc/node-postgres) er hrein JavaScript √∫tf√¶rsla af PostgresSQL client
* `npm install --save pg`
* Callback og promise vi√∞m√≥t
* Sty√∞ur _prepared statements_ sem vi√∞ notum **alltaf** til a√∞ minnka l√≠kur √° SQL injection √°r√°sum

---

## OWASP

* [Open Web Application Security Project](https://www.owasp.org/)
* Opin samt√∂k sem stu√∞la a√∞ √ær√≥un √∂ruggra vefforrita sem h√¶gt er a√∞ treysta
* Halda √∫ti top 10 lista yfir helstu √∂ryggish√¶ttur vefforrita
  - Tekinn saman af s√©rfr√¶√∞ingum √∫tfr√° reynslu og raunverulegum upp√°komum
  - Uppf√¶r√∞ur 2017, fyrsta √∫tg√°fa 2003

***

* [A10:2017 Insufficient Logging and Monitoring](https://github.com/OWASP/Top10/blob/master/2017/en/0xaa-logging-detection-response.md)
* [A9:2017 Using Components with Known Vulnerabilities](https://github.com/OWASP/Top10/blob/master/2017/en/0xa9-known-vulns.md)
* [A8:2017 Insecure Deserialization](https://github.com/OWASP/Top10/blob/master/2017/en/0xa8-insecure-deserialization.md)
* [A7:2017 Cross-Site Scripting (XSS)](https://github.com/OWASP/Top10/blob/master/2017/en/0xa7-xss.md)
* [A6:2017 Security Misconfiguration](https://github.com/OWASP/Top10/blob/master/2017/en/0xa6-security-misconfiguration.md)
* [A5:2017 Broken Access Control](https://github.com/OWASP/Top10/blob/master/2017/en/0xa5-broken-access-control.md)
* [A4:2017 XML External Entities (XXE)](https://github.com/OWASP/Top10/blob/master/2017/en/0xa4-xxe.md)
* [A3:2017 Sensitive Data Exposure](https://github.com/OWASP/Top10/blob/master/2017/en/0xa3-sensitive-data-disclosure.md)

***

## [A2:2017 Broken Authentication](https://github.com/OWASP/Top10/blob/master/2017/en/0xa2-broken-authentication.md)

* √År√°sara√∞ili stelur a√∞gangi annara me√∞ leka e√∞a vegna √∂ryggisgalla
  - T.d. _session fixation_, l√¶tur notanda skr√° sig inn √° √æekktu session
* A√∞ sm√≠√∞a au√∞kenningar og session kerfi r√©tt er **erfitt**
* Galli getur veri√∞ √≠ au√∞kenningunni sj√°lfri, √∫tskr√°ningu, session me√∞h√∂ndlun, gleymdu lykilor√∞s virkni o.s.fr.

***

## [A1:2017 Injection](https://github.com/OWASP/Top10/blob/master/2017/en/0xa1-injection.md)

* Ef g√∂gn fr√° notanda eru ekki sta√∞fest e√∞a hreinsu√∞ √°√∞ur en √æau eru notu√∞ √≠ skipanir getur √æa√∞ opna√∞ √≠ injection √°ras
* √År√°sara√∞ili √∫tb√Ωr texta sem n√Ωtir s√©r galla til a√∞ n√° s√Ωnu fram
* SQL injection algengast en getur l√≠ka √°tt vi√∞ a√∞ra hluti, XML, SMTP, OS a√∞ger√∞ir o.s.fr.
* Verndum okkur me√∞ √æv√≠ a√∞ treysta aldrei g√∂gnum fr√° notanda, hreinsa inntak, nota parameterized vi√∞m√≥t [o.fl.](https://github.com/OWASP/Top10/blob/master/2017/en/0xa1-injection.md#how-to-prevent)

---

## Au√∞kenning

* Au√∞kenning √° vi√∞ √æegar vi√∞ h√∂fum einhverja lei√∞ til √æess a√∞ greina hva√∞a notandi er a√∞ bi√∞ja um efni √° vefnum okkar
* Grunnurinn a√∞ lang flestum fl√≥knari vefjum

***

## Au√∞kenning og sta√∞a

* En HTTP er st√∂√∞ulaust? Hvernig geymum vi√∞ uppl√Ωsingar til lengri t√≠ma?
* G√¶tum nota√∞ faldar breytur √≠ formi (`<input type="hidden">`)
* E√∞a g√∂gn √≠ querystring (`/?session=FOO`)
* Mest nota√∞a lei√∞in er _cookies_ og _session_ til a√∞ geyma uppl√Ωsingarnar almennt
  - Kl√°rum au√∞kenningu og f√°um s√≠√∞an k√∂ku sem l√¶tur server vita hver vi√∞ erum

***

## express-session middleware

* Notum [express-session](https://github.com/expressjs/session) til a√∞ halda utan um session √≠ express
* B√Ωr til _session_ fyrir okkur og s√©r um a√∞ geyma gildi √≠ k√∂ku
* Gefur okkur a√∞gang a√∞ `req.session`

***

## Notendaumsj√≥n

* Eitt a√∞ hafa au√∞kenningu, anna√∞ a√∞ halda utan um notendur og uppl√Ωsingar tengdar √æeim
* √ç grunninn:
  - Au√∞kenni (t.d. notendanafn) og eitthva√∞ leyndarm√°l sem a√∞eins vi√∞komandi veit
  - Lei√∞ til a√∞ au√∞kenna sig vi√∞ server, og vi√∞halda og vita af √æeirri st√∂√∞u

***

## passport.js

* [passport.js](http://www.passportjs.org/) er mest nota√∞a lei√∞in til a√∞ halda utan um au√∞kenningu me√∞ Express
* Sty√∞ur mismunandi _strategies_ sem segja til um hvernig vi√∞ tengjumst vi√∞ notendagrunn
  - [`local`](https://github.com/jaredhanson/passport-local) leyfir okkur a√∞ nota ‚Äûokkar eigin‚Äú
  - til fyrir [Twitter](https://github.com/jaredhanson/passport-twitter), [Facebook](https://github.com/jaredhanson/passport-facebook), [o.fl.](http://www.passportjs.org/packages/)

---

## Heroku

* Platform as a service (PaaS)
  - Keyrir ofan √° AWS (Amazon Web Services)
* Getum keyrt forritin okkar √≠ ‚Äûsk√Ωinu‚Äú
* √ûurfum ekki a√∞ hugsa um a√∞ reka v√©lar
  - Keyrum forriti√∞ okkar sem ‚Äûapp‚Äú

***

## [The Twelve-Factor App](https://12factor.net/)

* Samansafn af 12 atri√∞um sem hj√°lpa okkur a√∞ skrifa forrit sem au√∞velt er a√∞ reka
* Br√∫ar a√∞ einhverju leiti bili√∞ √° milli _development_ og _operations_, _devops_
* Byggt √° reynslu Heroku

***

* [I. Codebase](https://12factor.net/codebase)
* [II. Dependencies](https://12factor.net/dependencies)
* [III. Config](https://12factor.net/config)
* [IV. Backing services](https://12factor.net/backing-services)
* [V. Build, release, run](https://12factor.net/build-release-run)
* [VI. Processes](https://12factor.net/processes)

***

* [VII. Port binding](https://12factor.net/port-binding)
* [VIII. Concurrency](https://12factor.net/concurrency)
* [IX. Disposability](https://12factor.net/disposability)
* [X. Dev/prod parity](https://12factor.net/dev-prod-parity)
* [XI. Logs](https://12factor.net/logs)
* [XII. Admin processes](https://12factor.net/admin-processes)

---

## Vef√æj√≥nustur

* W3C skilgreining:
  - "A Web service is a software system designed to support interoperable machine-to-machine interaction over a network"
  - Vef√æj√≥nusta er hugb√∫na√∞arkerfi hanna√∞ til a√∞ eiga samvirk samskipti, v√©l-√≠-v√©l yfir net

***

## Samvirkni ‚Äì interoperability

* Samvirkni gengur √∫t √° a√∞ l√°ta kerfi virka saman
* Syntactic interoperability ‚Äì m√°lskipunarsamvirkni
  - Vi√∞ getum tala√∞ saman og skipst √° g√∂gnum
* Semantic interoperability ‚Äì merkingarb√¶rsamvirkni
  - Vi√∞ vitum merkinguna √≠ samskiptum okkar‚Äîgetum t√∫lka√∞

***

## HTTP a√∞fer√∞ir

* `GET` ‚Äì bi√∞ur um √∫tg√°fu af tilgreindri au√∞lind, lang mest nota√∞a a√∞fer√∞in
* `HEAD` ‚Äì einsog `GET`, nema vill a√∞eins f√° hausa skilgreinda fyrir au√∞lind
* `POST` ‚Äì Bi√∞ur server um a√∞ taka vi√∞ einingu √≠ request sem n√Ωrri einingu, skilgreinda me√∞ URI. T.d. n√Ωtt svar vi√∞ umr√¶√∞u√ær√¶√∞i e√∞a n√Ω g√∂gn √≠ gagnagrunni

***

* `PUT` ‚Äì bi√∞ur um a√∞ eining √≠ request s√© geymd undir URI, ef √∂nnur er til n√∫ √æegar skal uppf√¶ra hana
* `DELETE` ‚Äì bi√∞ur um a√∞ √æa√∞ sem geymt er √° URI s√© eytt
* `PATCH` ‚Äì uppf√¶rir a√∞eins √æ√° hluta einingar sem sendir eru
* `TRACE` ‚Äì Skilar request til baka, debug
* `OPTIONS` ‚Äì Skilar til baka hva√∞a a√∞fer√∞ir √æj√≥nn sty√∞ur

***

## St√∂√∞uk√≥√∞ar ‚Äî status codes

√ûegar vef√æj√≥nn svarar me√∞ response gefur hann upp st√∂√∞uk√≥√∞a, sem t√∂lu og lesanlegan texta

* `1xx` ‚Äì Til uppl√Ωsinga
* `2xx` ‚Äì Gekk, success
* `3xx` ‚Äì √Åframsending, redirection
* `4xx` ‚Äì Villa hj√° client
* `5xx` ‚Äì Villa hj√° server

***

## REST

* Representational State Transfer, skilgreint √≠ [doktorsritger√∞ Roy Fielding fr√° √°rinu 2000](http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm)
* REST er arkitekt√∫rsst√≠ll sem hunsar √∫tf√¶rslu og samskipti en einbl√≠nir √° hlutverk eininga, samskipti √æeirra √° milli og takmarkanir √æar √°
* Skilgreinir sex takmarkanir √° arkitekt√∫r

***

## REST takmarkanir

* _Client-server_ ‚Äì _samr√¶mt vi√∞m√≥t_ a√∞skilur client og server
* _St√∂√∞ulaust_ ‚Äì engin sta√∞a er geymd √° milli bei√∞na
* _Cacheable_ ‚Äì client getur geymt afrit af svari, sv√∂r ver√∞a √æv√≠ a√∞ skilgreina hvort √æa√∞ megi e√∞a ekki

***

* _Lagskipt kerfi_ ‚Äì client √æarf ekki a√∞ vita hvort hann s√© tengdur enda server e√∞a hvort hann tengist einhverjum millili√∞
* _K√≥√∞i eftir √æ√∂rfum_ (ekki krafist) ‚Äì server getur sent k√≥√∞a til client til a√∞ auka virkni hans
* _Samr√¶mt vi√∞m√≥t_ ‚Äì Grunnur a√∞ h√∂nnun √° REST √æj√≥nustu, einfaldur og a√∞skildur ark√≠tekt√∫r √æ.a. client og server geta vaxi√∞ √≥h√°√∞ hvor √∂√∞rum

***

## Restful

* RESTful: notum JSON, HTTP a√∞ger√∞ir og st√∂√∞u k√≥√∞a en l√°tum anna√∞ liggja milli hluta
  - K√≥rr√©tt REST er fl√≥ki√∞
* (√Ütla√∞ur) einfaldleikinn er heillandi, s√©rstaklega √≠ byrjun √æegar f√≥lk var √æreytt √° st√≥rum og miklum XML skj√∂lum
* Gerum okkar besta til a√∞ √∫tb√∫a g√≥√∞ar vef√æj√≥nustur sem er √æ√¶gilegt a√∞ nota

***

## Paging

* √ûegar vi√∞ erum a√∞ vinna me√∞ miki√∞ af g√∂gnum √æurfum vi√∞ oft √° t√≠√∞um a√∞ takmarka hversu miklu er skila√∞
* Ekki v√¶nlegt a√∞ skila √∂llum _milj√≥n_ f√¶rslum til notanda
* Yfirleitt √∫tf√¶rt me√∞ √æv√≠ a√∞ skila _s√≠√∞um_

***

## Caching

√ûrj√°r lei√∞ir til a√∞ cache-a g√∂gn √≠ HTTP:

* Ferskleiki ‚Äì gefinn t√≠mi sem g√∂gn eru ‚Äûfersk‚Äú og ekki √æarf a√∞ s√¶kja aftur √° vef√æj√≥n, t.d. me√∞ `Cache-Control: max-age=n` haus
* Sta√∞festing ‚Äì getum fengi√∞ sta√∞festingu hvort g√∂gn s√©u enn √≠ lagi
  - t.d. me√∞ `If-Last-Modified` haus og `ETag` haus
* √ìgilding ‚Äì ef vi√∞ breytum g√∂gnum (`POST, PUT, DELETE`) √æ√° er cache hreinsa√∞

***

## Forrit sem cachea

* Getum √∫tb√∫i√∞ okkar eigin cache fyrir √Ωmislegt √≠ forritunum okkar
  - Cache √° gildi sem tekur langan t√≠ma a√∞ reikna (t.d. √∫r gagnagrunni)
  - Cache √° s√≠√∞u sem er lengi a√∞ vera b√∫in til (t.d. m√∂rg d√Ωr k√∂ll √≠ gagnagrunn)
  - Cache √° g√∂gnum fr√° API
  - o.s.fr.

---

## redis

* [redis](https://redis.io/) er gagnataga geymsla √≠ minni ‚Äì in-memory data structure store
  - Ekki _relational_
  - _NoSQL_
* Sty√∞ur strengi, lista, set og fleiri t√Ωpur

***

* redis vinnur a√∞eins √≠ skyndiminni og er √æv√≠ mj√∂g hratt
* Getum tengt margar v√©lar saman og unni√∞ √æannig me√∞ miki√∞ af g√∂gnum
* H√¶gt a√∞ kveikja √° a√∞ g√∂gn s√©u vistu√∞ √° disk
* √ç okkar tilfelli munum vi√∞ nota redis fyrir hluti sem ‚Äûmega gleymast‚Äú

***

## Caching pattern

1. Athugum hvort vi√∞ eigum g√∂gn √≠ cache
2. Ef svo er, skilum cache
3. Framkv√¶mum d√Ωra √∫treikning
4. Setjum ni√∞urst√∂√∞u √≠ cache
5. Skilum ni√∞urst√∂√∞u

---

## Scraping

* _Scraping_ er √æa√∞ a√∞ _skrapa_ g√∂gn af vef
* Reverse engineerum str√∫kt√∫r √∫r g√∂gnum √°√∞ur en √æau voru birt me√∞ HTML
* B√∫um til okkar eigin gagnastr√∫kt√∫r

***

## fetch

* B√∫um til request, einfaldasta lei√∞in er einfaldlega `fetch(url)` sem framkv√¶mir `GET` √° `url` og skilar Promise
* Getum l√≠ka sent inn `options` hlut sem anna√∞ vi√∞fang og gert √æ√° t.d. `POST`
* F√°um til baka `response` hlut sem vi√∞ athugum `status` √°

***

* Eftir a√∞ vi√∞ f√°um response √æurfum vi√∞ a√∞ √°kve√∞a hvernig vi√∞ f√°um g√∂gnin
  - `JSON` me√∞ `response.json()`
  - Fyrir texta `response.text()`
  - Binary g√∂gn `response.blob()`
* Skilar allt Promise

***

## Vinna √∫r g√∂gnum

* Eftir a√∞ vi√∞ s√¶kjum g√∂gnin √æurfum vi√∞ √° einhvern h√°tt a√∞ vinna √∫r √æeim, √æ√° helst HTML
  - G√¶tum reynt a√∞ s√¶kja eitthva√∞ me√∞ strengjaleikfimi og regex
  - HTML er almennt ekki h√¶gt a√∞ t√∫lka me√∞ regex
  - H√¶gt, broth√¶tt og √≥√¶skilegt

---

## Grunnhugmynd React

* React byggir √° √æv√≠ a√∞ a√∞skilna√∞ur milli markup √≠ formi template m√°la og l√≥g√≠kar (JavaScript) s√© √≥r√∂kr√©ttur
  - Template m√°l hafa √∂√∞ruv√≠si, ekki jafn kr√∂ftugan syntax
* Markup og l√≥g√≠k eru √≠ e√∞li s√≠nu tengd saman og √æessi a√∞skilna√∞ur byggir _√° t√¶kni_

***

## React

* Highly cohesive
  - Hver hluti inniheldur lang flest sem √æarf til birtingar og notkunar
* Loosely coupled
  - Hver hluti er sj√°lfum s√©r n√¶gur og √æarf ekki a√∞ra hluti

***

## JSX tr√©

* Myndar _tr√©_ einsog DOM
  - JSX m√° hrei√∞ra
* Element sem byrja √° st√≥rum staf eru **React element**
* Element sem byrja √° litlum staf eru t√∫lku√∞ sem DOM element
* √ñll lauf tr√©s eru DOM element

***

## Declarative API

* React hefur _declarative API_
  - Einsog HTML
* Vi√∞ segjum hvernig vi√∞ viljum a√∞ UI s√© og react passar upp√° a√∞ √æa√∞ passi
* √ìl√≠kt _imperative_ API √æar sem vi√∞ framkv√¶mum skref-fyrir-skref √æa√∞ sem √æarf til a√∞ UI s√© r√©tt

***

## Uppf√¶rsla √≠ DOM

* Ef eitthva√∞ l√¶tur `element` breytast, e√∞a ef vi√∞ k√∂llum aftur √≠ `render` mun React _a√∞eins uppf√¶ra_ √æa√∞ sem breyttist
* React heldur utan um ‚Äûvirtual DOM‚Äú (VDOM) sem er sta√∞a √° UI geymd √≠ minni sem er s√≠√∞an syncu√∞ vi√∞ alv√∂ru DOM
  - √ûetta sync er kalla√∞ [reconciliation](https://reactjs.org/docs/reconciliation.html)

***

## Components

* Me√∞ √æv√≠ a√∞ nota components getum vi√∞ skipt vi√∞m√≥tinu okkar upp √≠ sj√°lfst√¶√∞ar einingar
  - Mj√∂g g√≥√∞ p√¶ling sem virkar afskaplega vel √≠ prax√≠s
* Getum hugsa√∞ um component einsog JavaScript fall: tekur vi√∞ `props` (properties) sem hlut me√∞ g√∂gnum og skilar React element(s)

***

## Props

* React components √¶ttu a√∞ vera hrein f√∂ll m.t.t. props
  - Aldrei breyta props, √æau eru read-only
* √ûegar vi√∞ breg√∞umst vi√∞ breytingum √≠ UI notum vi√∞ _state_
* `children` er s√©rstakt prop sem inniheldur _b√∂rn_ elements, ef einhver

***

## propTypes

* Eftir √æv√≠ sem vi√∞ skrifum fleiri components og setjum √æau saman aukast l√≠kur √° b√∂ggum
* React hefur stu√∞ning vi√∞ [`prop-types`](https://github.com/facebook/prop-types) sem keyrir _type check_ √° runtime √≠ √ær√≥un
* Skilgreinum sem `propTypes` hlut √° `function` e√∞a `class`
  - Hver lykill √≠ hlut √° vi√∞ eitt prop, gildi lykils er ger√∞ sem prop √¶tti a√∞ vera

***

## State

* Keiml√≠kt `props` en er pr√≠vat fyrir component
* Stj√≥rna√∞ af component a√∞ √∂llu leiti
* A√∞eins til sta√∞ar ef component skilgreint sem `class`
* √Üttum a√∞eins a√∞ setja hluti sem ver√∞a birtir √≠ `state`, √∂nnur g√∂gn getum vi√∞ geymt √° `class` me√∞ `this`

***

## Fl√¶√∞i gagna

* Componentum √° a√∞ vera alveg sama hvort a√∞rir componentar hafi st√∂√∞u e√∞a ekki; s√©u functional e√∞a ekki
* `state` er h√°√∞ √∫tf√¶rslu component og er aldrei a√∞gengilegt √∂√∞rum componentum
  - Nema component sendi part af st√∂√∞u √°fram √≠ _prop_ hj√° √∂√∞rum component

***

## G√∂gn fl√¶√∞a ni√∞ur

* G√∂gn √≠ react fl√¶√∞a alltaf _ni√∞ur_
  - _top-down_ e√∞a _unidirectional_ gagnafl√¶√∞i
* √ûetta vefst fyrir m√∂rgum sem byrja a√∞ nota react

***

## Lifecycle methods

* Lifecycle methods/hooks eru √æa√∞ sem vi√∞ notum til a√∞ breg√∞ast vi√∞ breytingum √° ‚Äûl√≠fi‚Äú component
  - Er b√∫i√∞ a√∞ b√∫a component til √≠ DOM? Er veri√∞ a√∞ fjarl√¶gja hann? Var component a√∞ f√° n√Ω prop? O.s.fr.
* Leyfir okkur a√∞ keyra k√≥√∞a og gera uppf√¶rslur √° st√∂√∞u e√∞a skila uppl√Ωsingum um component √° hverjum t√≠mapunkti

***

## Atbur√∞ir √≠ react

* Atbur√∞ir √≠ react eru svipa√∞ir DOM atbur√∞um me√∞ sm√° undantekningum
* camelCase og f√∂ll en ekki strengir
* `<button onclick="activateLasers()">` VS `<button onClick={activateLasers}>`
* üò±

***

## Ajax

* A√∞ s√¶kja g√∂gn er ekki √≥svipa√∞ √æv√≠ sem vi√∞ h√∂fum n√∫ √æegar gert me√∞ `fetch`
  - [Stutt √≠ √∂llum n√Ωlegum browserum](https://caniuse.com/#feat=fetch)
* Getum nota√∞ `async await` me√∞ CRA üéâ
  - K√∂llum yfirleitt √≠ g√∂gn √∫r `componentDidMount` svo vi√∞ merkjum √æa√∞ sem `async`

***

## St√∂√∞ur √° g√∂gnum

* √Üttum a√∞ me√∞h√∂ndla √ærj√°r st√∂√∞ur:
  - Loading: veri√∞ a√∞ s√¶kja g√∂gn
  - Error: eitthva√∞ kom upp vi√∞ a√∞ s√¶kja g√∂gn
  - Success: g√∂gn s√≥tt og birt

***

## react-router

* [`react-router`](https://reacttraining.com/react-router/) er samansafn af components sem leyfa okkur a√∞ skilgreina lei√∞arkerfi √≠ react
* Notar declarative API og _dynamic_ routing
* Virkar √° vef og √≠ react native
* S√¶kjum `react-router-dom`
  - `npm install --save react-router-dom`

***

## Sta√∞a √≠ st√¶rri forritum

* St√¶rri forrit √æurfa yfirleitt a√∞ deila st√∂√∞u √° milli hluta
  - Er notandi innskr√°√∞ur? Er b√∫i√∞ a√∞ s√¶kja g√∂gn?
* Ein lei√∞ er a√∞ ‚Äûlyfta st√∂√∞u‚Äú upp tr√©√∞ og l√°ta sameiginlegt foreldri sj√° um st√∂√∞u fyrir systkini

***

## CSS

* √ûar sem vi√∞ einangrum virkni √≠ componentum minnkar √æ√∂rf √° a√∞ nota s√©rst√∂k t√≥l eins og Sass
* Geymum component √≠ m√∂ppu og h√∂fum CSS skr√° √≠ s√∂mu m√∂ppu
* V√≠sum √≠ CSS √° einhvern h√°tt og tengjum √æannig vi√∞ component
  - √ç CRA: `import './Component.css';`

---

## Verkefni

* √ç verkefnum h√∂fum vi√∞ gl√≠mt vi√∞ √Ωmis verkefni
* Eftirfarandi listi mi√∞ar vi√∞ s√Ωnilausnir og yfirfer√∞ir √° √æeim

***

## Verkefni 1

* Lestur skr√°a af disk me√∞ nodejs
* Ke√∞jun async a√∞ger√∞a
* Notkun ejs templatea

***

## Verkefni 2

* Sta√∞festing og hreinsun gagna me√∞ p√∂kkum
* Fl√¶√∞i fr√° √æv√≠ a√∞ notandi sendir g√∂gn √∫r formi, √æau s√≥tt √∫r formi, sta√∞fest og vistu√∞ √≠ gagnagrunni, villume√∞h√∂ndlun
* Uppsetning og fl√¶√∞i vi√∞ innskr√°ningu
* Skr√°ning og lestur gagna √∫r gagnagrunni

***

## Verkefni 3

* Uppskipting √° verkefni √≠ k√≥√∞a og API vi√∞m√≥t
* ‚ÄûRESTful‚Äú vef√æj√≥nustuskil sem n√Ωta status k√≥√∞a og JSON
* Uppf√¶rslur og ey√∞ing gagna √∫r gagnagrunni

***

## Verkefni 4

* ‚ÄûScraping‚Äú √° g√∂gnum og √∫rvinnsla √æeirra me√∞ t√≥li einsog cheerio
* redis sem caching lag og a√∞fer√∞ir til a√∞ setja og s√¶kja √∫r
* `fetch` api

***

## Verkefni 5

* Uppsetning √° react verkefni
* G√∂gn s√≥tt async og √æ√¶r st√∂√∞ur sem √æarf a√∞ huga a√∞
* Samspil st√∂√∞u √≠ component og ‚Äûbarna‚Äú √æess
